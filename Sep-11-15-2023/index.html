<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="P1  Video  SQLite as a collaborative application file format Strut staring it off Tab sync CRR Local-only (undo, selection state) Sort Constant events / metadata size Schema change & reload & auto-migrate  Table is sensitive to schema?"><meta property="og:title" content="Sep 11-15 2023"><meta property="og:description" content="P1  Video  SQLite as a collaborative application file format Strut staring it off Tab sync CRR Local-only (undo, selection state) Sort Constant events / metadata size Schema change & reload & auto-migrate  Table is sensitive to schema?"><meta property="og:type" content="website"><meta property="og:image" content="https://vlcn-io.github.io/knowledgebase/icon.png"><meta property="og:url" content="https://vlcn-io.github.io/knowledgebase/Sep-11-15-2023/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="Sep 11-15 2023"><meta name=twitter:description content="P1  Video  SQLite as a collaborative application file format Strut staring it off Tab sync CRR Local-only (undo, selection state) Sort Constant events / metadata size Schema change & reload & auto-migrate  Table is sensitive to schema?"><meta name=twitter:image content="https://vlcn-io.github.io/knowledgebase/icon.png"><meta name=twitter:site content="vlcnio"><title>Sep 11-15 2023</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://vlcn-io.github.io/knowledgebase//icon.png><link href=https://vlcn-io.github.io/knowledgebase/styles.80333fa2099c0bee674efa435fde378c.min.css rel=stylesheet><link href=https://vlcn-io.github.io/knowledgebase/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://vlcn-io.github.io/knowledgebase/js/darkmode.bfea887056c3a94b77f0f84698db5803.min.js></script>
<script src=https://vlcn-io.github.io/knowledgebase/js/util.00639692264b21bc3ee219733d38a8be.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script defer src=https://vlcn-io.github.io/knowledgebase/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://vlcn-io.github.io/knowledgebase/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://vlcn-io.github.io/knowledgebase/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://vlcn-io.github.io/knowledgebase/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://vlcn-io.github.io/knowledgebase/",fetchData=Promise.all([fetch("https://vlcn-io.github.io/knowledgebase/indices/linkIndex.d420ab009398809ff425f80d5fb25a89.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://vlcn-io.github.io/knowledgebase/indices/contentIndex.b5ce989a67fa7542ab0211ea684924d1.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://vlcn-io.github.io/knowledgebase",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://vlcn-io.github.io/knowledgebase",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/vlcn-io.github.io\/knowledgebase\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=vlcn-io.github.io/knowledgebase src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://vlcn-io.github.io/knowledgebase/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://vlcn-io.github.io/knowledgebase/>ðŸª´ Vulcan Garden</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Sep 11-15 2023</h1><p class=meta>Last updated
Sep 26, 2023
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/Sep%2011-15%202023.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents></nav></details></aside><a href=#p1><h1 id=p1><span class=hanchor arialabel=Anchor># </span>P1</h1></a><ul><li><input checked disabled type=checkbox> Video<ul><li><input checked disabled type=checkbox> SQLite as a collaborative application file format</li><li><input checked disabled type=checkbox> Strut staring it off</li><li><input checked disabled type=checkbox> Tab sync</li><li><input checked disabled type=checkbox> CRR</li><li><input checked disabled type=checkbox> Local-only (undo, selection state)</li><li><input checked disabled type=checkbox> Sort</li><li><input checked disabled type=checkbox> Constant events / metadata size</li><li><input checked disabled type=checkbox> Schema change & reload & auto-migrate<ul><li><input checked disabled type=checkbox> Table is sensitive to schema?</li></ul></li><li><input checked disabled type=checkbox> Switch to WebSocket streaming at the end</li><li><input checked disabled type=checkbox> Maybe even introduce typed-sql?</li><li><input disabled type=checkbox> full text search in the example too?</li></ul></li><li><input disabled type=checkbox> Metadata Weight<ul><li><input disabled type=checkbox> PKs<ul><li><input disabled type=checkbox> new table</li><li><input disabled type=checkbox> trigger updates</li><li><input disabled type=checkbox> vtab select</li><li><input disabled type=checkbox> vtab insert</li><li><input disabled type=checkbox> migration / backfill stuff?</li></ul></li></ul></li><li><input disabled type=checkbox> Manual Migration<ul><li><input disabled type=checkbox> Disable auto-mig</li><li><input disabled type=checkbox> Provide path to specify migration files</li></ul></li><li><input disabled type=checkbox> Personal<ul><li><input disabled type=checkbox> Car</li><li><input disabled type=checkbox> Rental</li><li><input disabled type=checkbox> Projector</li></ul></li><li><input disabled type=checkbox> Blog abt &ldquo;this time it is different&rdquo;?<ul><li><input disabled type=checkbox>
<a href="https://news.ycombinator.com/item?id=37488034" rel=noopener>https://news.ycombinator.com/item?id=37488034</a></li><li><input disabled type=checkbox> &ldquo;Local First Misconceptions&rdquo;</li></ul></li><li><input disabled type=checkbox> wa-sqlite sqlite 3.43</li></ul><a href=#p2><h1 id=p2><span class=hanchor arialabel=Anchor># </span>P2</h1></a><ul><li><input disabled type=checkbox> Live Resolvers &ndash;
<a href=https://github.com/captbaritone/redux-to-relay-with-live-resolvers-example/fork rel=noopener>https://github.com/captbaritone/redux-to-relay-with-live-resolvers-example/fork</a><ul><li><input disabled type=checkbox> Past:
<a href=https://github.com/tslater/reactnative-relay-offline rel=noopener>https://github.com/tslater/reactnative-relay-offline</a></li><li><input disabled type=checkbox>
<a href=https://github.com/captbaritone/redux-to-relay-with-live-resolvers-example/tree/SQL-2 rel=noopener>https://github.com/captbaritone/redux-to-relay-with-live-resolvers-example/tree/SQL-2</a></li></ul></li></ul><p>Automigrate errors still exist?
Status code 500 not showing error on user interface?</p><ul><li><a href=https://twitter.com/smashingmag/status/410118699577012224 rel=noopener>https://twitter.com/smashingmag/status/410118699577012224</a></li><li>strut.io</li><li>auto-prepare insert statements? and re-use?</li></ul><a href=#notes><h1 id=notes><span class=hanchor arialabel=Anchor># </span>Notes</h1></a><p>Thoughts:
&ldquo;Application file format&rdquo;</p><ul><li><p>Postgres backend</p></li><li><p>SQLite 2 SQLite</p></li><li><p>P2P webrtc</p></li><li><p>Reactivity / instant interaction</p></li><li><p>Text CRDTs?</p></li><li><p>Rebase and mutation(s) approach</p></li><li><p>Whole db? partial? row level securit?</p></li><li><p><input checked disabled type=checkbox> crsql_create_crr needs to update TableInfo in ext data such that we do not need to call <code>ensureUpToDate</code></p></li><li><p><input disabled type=checkbox> Data not replicated after primary key change? Clock records not moved or whatever?</p></li><li><p><input disabled type=checkbox> auto-migrator fails with trigger changes?</p><ul><li><input disabled type=checkbox> vite starter better refresh by moving root ou. p2p repro fails refresh</li><li><input disabled type=checkbox> Drop tirggers if triggers taken out of schema?</li></ul></li></ul><p>Update table info after migrate. Why? Because we use it for merge to construct pk where lists and the like.</p><p>We need to invalidate cached statements for a given table post migrate&mldr;
We could also not use the b-tree and instead cache statements in table info as needed.</p><hr><p>We can statically analyze and pull fragments used by components and combine them into an incremental pipeline and incrementally maintain the view which is the UI.</p><hr><p>New trigger:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>on_insert() {
</span></span><span class=line><span class=cl>  let key = SELECT key FROM lookaside WHERE pk_where_list;
</span></span><span class=line><span class=cl>  if !key {
</span></span><span class=line><span class=cl>	// could reverse and do inser or ignore since insert common
</span></span><span class=line><span class=cl>	// case is it not existing
</span></span><span class=line><span class=cl>    key = INSERT INTO lookaside VALUES (...) RETURNING key;
</span></span><span class=line><span class=cl>    // non-conflict clock set
</span></span><span class=line><span class=cl>  } else {
</span></span><span class=line><span class=cl>    // conflict clock set
</span></span><span class=line><span class=cl>  }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>on_update() {
</span></span><span class=line><span class=cl>  let key = SELECT key FROM lookaside WHERE pk_where_list;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>on_delete() {
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>// prepared:
</span></span><span class=line><span class=cl>// 1. SELECT key FROM lookaside
</span></span><span class=line><span class=cl>// 2. INSERT OR IGNORE INTO lookaside VALUES () RETURNING key;
</span></span><span class=line><span class=cl>// 3. 
</span></span><span class=line><span class=cl>// Causal length can move to lookaside too!
</span></span><span class=line><span class=cl>// Hmm.. maybe later since we need sentinel log.
</span></span></code></pre></td></tr></table></div></div><hr><p>SQLite was the perfect embedded database for the last two decades but it&rsquo;s lacking in today&rsquo;s era of collaborative and multiplayer applications.</p><p>To remedy that, I&rsquo;ve extended SQLite over the last year to give it the ability to support multiplayer and collaborative applications. It works by allowing SQLite databases, on different devices, to be merged together in real time.</p><p>Thanks to help and feedback from
<a href=https://fly.io rel=noopener>https://fly.io</a>,
<a href=https://expo.dev rel=noopener>https://expo.dev</a> and
<a href=https://braid.org rel=noopener>https://braid.org</a> I&rsquo;ve put together an end to end developer experience around SQLite state synchronization to help anyone build the next Figma, Google Docs or Linear.app without needing to be a distributed systems expert.</p><p>Watch the video overview here:</p><p><a href="https://www.youtube.com/watch?v=T1ES9x8DKR4" rel=noopener>https://www.youtube.com/watch?v=T1ES9x8DKR4</a></p><p>Or check out the project website:
<a href=https://vlcn.io/docs rel=noopener>https://vlcn.io/docs</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>-Wl,--no-as-needed -ldl
</span></span><span class=line><span class=cl>-pthread -lpthread
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>valgrind</span> <span class=o>--</span><span class=n>leak</span><span class=o>-</span><span class=n>check</span><span class=o>=</span><span class=n>full</span> \
</span></span><span class=line><span class=cl>         <span class=o>--</span><span class=n>show</span><span class=o>-</span><span class=n>leak</span><span class=o>-</span><span class=n>kinds</span><span class=o>=</span><span class=n>all</span> \
</span></span><span class=line><span class=cl>         <span class=o>--</span><span class=n>track</span><span class=o>-</span><span class=n>origins</span><span class=o>=</span><span class=n>yes</span> \
</span></span><span class=line><span class=cl>         <span class=o>--</span><span class=n>verbose</span> \
</span></span><span class=line><span class=cl>         <span class=o>--</span><span class=n>log</span><span class=o>-</span><span class=n>file</span><span class=o>=</span><span class=n>valgrind</span><span class=o>-</span><span class=n>out</span><span class=p>.</span><span class=n>txt</span> \
</span></span><span class=line><span class=cl>         <span class=p>.</span><span class=o>/</span><span class=n>executable</span> <span class=n>exampleParam1</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>#sqlite</strong> <strong>#crdts</strong> <strong>#collaboration</strong></p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://vlcn-io.github.io/knowledgebase/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by Matt Wonlaw using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2023</p><ul><li><a href=https://vlcn-io.github.io/knowledgebase/>Home</a></li><li><a href=https://twitter.com/vlcnio>Twitter</a></li><li><a href=https://github.com/vlcn-io>GitHub</a></li></ul></footer></div></div></body></html>